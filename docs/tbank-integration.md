# Интеграция Т-Банка в AI Fire LMS Academy

## Обзор

Данная интеграция позволяет принимать платежи за курсы через платежную систему Т-Банка.

## Установка

### 1. Создание таблиц базы данных

Выполните SQL-скрипт для создания необходимых таблиц:

```sql
-- Выполните файл database/payments.sql
```

### 2. Настройка конфигурации

Создайте файл `.env` в корне проекта со следующими параметрами:

```env
# Конфигурация Т-Банка
TBANK_MERCHANT_ID=your_merchant_id_here
TBANK_SECRET_KEY=your_secret_key_here
TBANK_TEST_MODE=true
TBANK_NOTIFICATION_URL=https://your-domain.com/payment/notification
```

### 3. Настройка роутинга

Добавьте следующие маршруты в ваш роутер:

```php
// Платежи
$router->get('/payment/buy-course', 'PaymentController@buyCourse');
$router->post('/payment/create-payment', 'PaymentController@createPayment');
$router->get('/payment/success', 'PaymentController@success');
$router->post('/payment/notification', 'PaymentController@notification');
$router->get('/payment/history', 'PaymentController@history');
$router->post('/payment/check-status', 'PaymentController@checkStatus');
```

## Использование

### Для пользователей

1. **Покупка курса**: Пользователь переходит на страницу курса и нажимает "Купить курс"
2. **Оплата**: Перенаправление на страницу оплаты Т-Банка
3. **Подтверждение**: После успешной оплаты пользователь возвращается на сайт
4. **Доступ**: Курс становится доступным в личном кабинете

### Для администраторов

1. **Установка цены**: При создании/редактировании курса установите цену
2. **Мониторинг**: Просматривайте платежи в админ-панели
3. **Статистика**: Анализируйте доходы и конверсию

## API Т-Банка

### Основные методы

- `createPayment()` - создание платежа
- `checkPaymentStatus()` - проверка статуса платежа
- `processNotification()` - обработка уведомлений

### Статусы платежей

- `pending` - ожидает оплаты
- `completed` - оплачен
- `failed` - неудачный
- `cancelled` - отменен

## Безопасность

### Проверка подписи

Все уведомления от Т-Банка проверяются по подписи для предотвращения подделки.

### Валидация данных

- Проверка существования курса
- Проверка авторизации пользователя
- Валидация суммы платежа

## Тестирование

### Тестовый режим

1. Установите `TBANK_TEST_MODE=true` в конфигурации
2. Используйте тестовые данные Т-Банка
3. Проверьте все сценарии оплаты

### Тестовые карты

Используйте тестовые карты Т-Банка для проверки различных сценариев.

## Мониторинг

### Логирование

Все операции с платежами логируются в `error.log`:

```php
error_log('TBank notification received: ' . json_encode($notificationData));
```

### Уведомления

Система отправляет уведомления пользователям о:
- Успешной оплате
- Неудачной оплате
- Проблемах с платежом

## Поддержка

### Частые проблемы

1. **Не приходят уведомления**: Проверьте доступность URL уведомлений
2. **Ошибки подписи**: Убедитесь в правильности секретного ключа
3. **Платежи не создаются**: Проверьте конфигурацию API

### Контакты

- Техническая поддержка Т-Банка: [support@tbank.ru](mailto:support@tbank.ru)
- Документация API: [https://tbank.ru/api/docs](https://tbank.ru/api/docs)

## Обновления

### Версия 1.0

- Базовая интеграция с Т-Банком
- Поддержка разовых платежей
- Система уведомлений
- История платежей

### Планы развития

- Поддержка подписок
- Возврат средств
- Аналитика платежей
- Интеграция с другими платежными системами 